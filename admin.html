<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Admin Restaurante Pepito</title>
<link rel="stylesheet" href="css/styles.css">
<style>
  body { font-family: 'Georgia', serif; background-color: #f5f5f0; color: #2c2c2c; padding: 20px; }
  .admin-container { max-width: 800px; margin: 20px auto; background: white; padding: 30px; box-shadow: 0 5px 20px rgba(0,0,0,0.1); border-radius: 8px; }
  h1, h2 { text-align: center; margin-bottom: 20px; }
  #login-form input { width: 100%; padding: 8px; margin: 5px 0; border: 1px solid #ccc; border-radius: 4px; }
  #login-form button { width: 100%; padding: 10px; margin-top: 10px; background-color: #333; color: white; border: none; border-radius: 4px; cursor: pointer; }
  #login-form button:hover { background-color: #555; }

  .categoria { margin-top: 30px; }
  .categoria h3 { border-bottom: 2px solid #333; padding-bottom: 5px; margin-bottom: 10px; }
  .menu-item { display: flex; justify-content: space-between; align-items: center; padding: 8px 10px; border-bottom: 1px solid #eee; border-radius: 4px; margin-bottom: 5px; background: #fafafa; }
  .menu-item span { flex: 1; }
  .menu-item button { background-color: #c0392b; color: white; border: none; padding: 5px 10px; border-radius: 4px; cursor: pointer; }
  .menu-item button:hover { background-color: #e74c3c; }

  .add-form { margin-top: 20px; display: grid; gap: 10px; }
  .add-form input, .add-form select { padding: 8px; border: 1px solid #ccc; border-radius: 4px; }
  .add-form button { padding: 10px; background-color: #27ae60; color: white; border: none; border-radius: 4px; cursor: pointer; }
  .add-form button:hover { background-color: #2ecc71; }

  #logoutBtn { margin-top: 20px; background-color: #333; color: white; width: 100%; padding: 10px; border-radius: 4px; cursor: pointer; }
  #logoutBtn:hover { background-color: #555; }
</style>
</head>
<body>

<div class="admin-container">
  <h1>Panel Admin Restaurante Pepito</h1>

  <div id="login-form">
    <input type="email" id="email" placeholder="Email">
    <input type="password" id="password" placeholder="Password">
    <button id="loginBtn">Login</button>
    <p id="loginError" style="color:red"></p>
  </div>

  <div id="admin-panel" style="display:none;">
    <h2>Tu menú</h2>
    <div id="menuContainer"></div>

    <div class="add-form">
      <h3>Agregar plato</h3>
      <input id="newPlato" placeholder="Plato">
      <input id="newDesc" placeholder="Descripción">
      <input id="newPrecio" type="number" placeholder="Precio">
      <select id="newCat">
        <option>Entrantes</option>
        <option>Primeros platos</option>
        <option>Segundos platos</option>
        <option>Postres</option>
        <option>Bebidas</option>
      </select>
      <button id="addBtn">Agregar plato</button>
    </div>

    <button id="logoutBtn">Logout</button>
  </div>
</div>

<script type="module">
import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm'

const supabaseUrl = 'https://qozzxdrjwjskmwmxscqj.supabase.co'
const supabaseKey = 'sb_publishable_UtBfupVv8e2zniYdv1jvEA_SXIyWE0Z'
const supabase = createClient(supabaseUrl, supabaseKey)

let user = null
const categorias = ["Entrantes","Primeros platos","Segundos platos","Postres","Bebidas"]

// Login
document.getElementById('loginBtn').onclick = async () => {
  const email = document.getElementById('email').value
  const password = document.getElementById('password').value
  const { data, error } = await supabase.auth.signInWithPassword({ email, password })
  if (error) { 
    document.getElementById('loginError').textContent = error.message
    return
  }
  user = data.user
  document.getElementById('login-form').style.display = 'none'
  document.getElementById('admin-panel').style.display = 'block'
  cargarMenu()
}

// Logout
document.getElementById('logoutBtn').onclick = async () => {
  await supabase.auth.signOut()
  user = null
  document.getElementById('admin-panel').style.display = 'none'
  document.getElementById('login-form').style.display = 'block'
}

// Cargar menú por categoría
async function cargarMenu() {
  const { data: menu, error } = await supabase
    .from('Menu')
    .select('*')
    .eq('user_id', user.id)
    .order('id')

  const container = document.getElementById('menuContainer')
  container.innerHTML = ''

  categorias.forEach(cat => {
    const catDiv = document.createElement('div')
    catDiv.className = 'categoria'
    const catHeader = document.createElement('h3')
    catHeader.textContent = cat
    catDiv.appendChild(catHeader)

    const catItems = menu.filter(item => item.categoria === cat)
    catItems.forEach(item => {
      const div = document.createElement('div')
      div.className = 'menu-item'
      div.innerHTML = `
        <span>${item.plato} – ${item.descripcion}${item.precio ? ' – €'+item.precio : ''}</span>
        <button data-id="${item.id}">Borrar</button>
      `
      div.querySelector('button').onclick = async () => {
        await supabase.from('Menu').delete().eq('id', item.id)
        cargarMenu()
      }
      catDiv.appendChild(div)
    })

    container.appendChild(catDiv)
  })
}

// Agregar plato
document.getElementById('addBtn').onclick = async () => {
  const plato = document.getElementById('newPlato').value
  const desc = document.getElementById('newDesc').value
  const precio = document.getElementById('newPrecio').value
  const cat = document.getElementById('newCat').value
  if (!plato) return alert('El plato es obligatorio')

  await supabase.from('Menu').insert([{ plato, descripcion: desc, precio, categoria: cat, user_id: user.id }])
  document.getElementById('newPlato').value = ''
  document.getElementById('newDesc').value = ''
  document.getElementById('newPrecio').value = ''
  cargarMenu()
}
</script>

</body>
</html>
