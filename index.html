<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Carta Restaurante Pepito</title>
<link rel="stylesheet" href="css/styles.css">
</head>
<body>

<div class="container">
  <header>
    <h1>Restaurante Pepito</h1>
    <p>Carta digital üçΩÔ∏è</p>
  </header>

  <main>
    <section class="menu-section">
      <button class="collapsible">Entrantes</button>
      <div class="content"><ul id="Entrantes"></ul></div>
    </section>

    <section class="menu-section">
      <button class="collapsible">Primeros platos</button>
      <div class="content"><ul id="PrimerosPlatos"></ul></div>
    </section>

    <section class="menu-section">
      <button class="collapsible">Segundos platos</button>
      <div class="content"><ul id="SegundosPlatos"></ul></div>
    </section>

    <section class="menu-section">
      <button class="collapsible">Postres</button>
      <div class="content"><ul id="Postres"></ul></div>
    </section>

    <section class="menu-section">
      <button class="collapsible">Bebidas</button>
      <div class="content"><ul id="Bebidas"></ul></div>
    </section>
  </main>

  <footer>
    <p>¬© 2026 Restaurante Pepito</p>
  </footer>
</div>

<script type="module">
import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm'

const supabaseUrl = 'https://qozzxdrjwjskmwmxscqj.supabase.co'
const supabaseKey = 'sb_publishable_UtBfupVv8e2zniYdv1jvEA_SXIyWE0Z'
const supabase = createClient(supabaseUrl, supabaseKey)

// Obtener clienteId desde query string
const params = new URLSearchParams(window.location.search)
const clienteId = params.get('cliente') // UUID del usuario

async function cargarCarta(clienteId) {
  if (!clienteId) return // no hay usuario, carta vac√≠a

  const { data: menu, error } = await supabase
    .from('Menu')
    .select('*')
    .eq('user_id', clienteId)
    .order('id')

  if (error) return console.error(error)

  const mapCat = {
    "Entrantes": "Entrantes",
    "Primeros platos": "PrimerosPlatos",
    "Segundos platos": "SegundosPlatos",
    "Postres": "Postres",
    "Bebidas": "Bebidas"
  }

  menu.forEach(item => {
    const ul = document.getElementById(mapCat[item.categoria])
    if (!ul) return
    const li = document.createElement('li')
    li.style.display = 'flex'
    li.style.justifyContent = 'space-between'
    li.style.marginBottom = '10px'
    li.innerHTML = `
      <div>
        <span class="dish">${item.plato}</span>
        ${item.descripcion ? ' ‚Äì ' + item.descripcion : ''}
      </div>
      ${item.precio ? `<div class="precio">‚Ç¨${item.precio}</div>` : ''}
    `
    ul.appendChild(li)
  })
}

// Collapsibles
document.querySelectorAll(".collapsible").forEach(btn => {
  btn.addEventListener("click", () => {
    document.querySelectorAll(".collapsible").forEach(otherBtn => {
      if (otherBtn !== btn) {
        otherBtn.classList.remove("active")
        otherBtn.nextElementSibling.style.display = "none"
      }
    })
    btn.classList.toggle("active")
    const content = btn.nextElementSibling
    content.style.display = content.style.display === "block" ? "none" : "block"
  })
})

// Cargar carta si hay clienteId
if (clienteId) cargarCarta(clienteId)
</script>

</body>
</html>
